# Installation

In your terminal navigate to the folder you want to clone this repo into and clone with 
```
git clone https://github.com/Landscape-CV/PyTLiDAR.git
cd PyTLiDAR
```
## Create a .venv & requirements installed
### Mac
```
python -m venv .venv
. .venv/bin/activate
pip install -r requirements.txt
```
### Windows
```
python -m venv .venv
. .venv/Scripts/activate
pip install -r requirements.txt
```
### CSF Dependency (Ecomodel Only)

The Ecomodel framework is dependent on the Cloth Simulation Filter ground filtering algorithm available here:
https://github.com/jianboqi/CSF

This version has not been updated to work with Numpy version >=2.0, so you will need to recompile it locally using the following instructions:

Download the above repository
Locate the file pyproject.toml and replace the contents with the following:
```
`[build-system]
requires = ["wheel","setuptools", "numpy>=2.0.0rc1"]
dependencies = ["oldest-supported-numpy"]
build-backend = "setuptools.build_meta"

[tool.cibuildwheel]
build = "cp3{8,9,10,11,12}-*" `
```
Run ```python setup.py bdist_wheel ```
(make sure you have installed setuptools wheel using pip install setuptools wheel)

you can then run 
```pip install dist/<name of the generated file>```

You will then be able to run the ecomodel framework.

# TreeQSM

### TreeQSM Application Usage

When launching the application (main.py) a window with parameter selection will appear. This is the interface, and provides instructions for usage.
You may choose to run a single file or multiple, with the ability to view the point cloud and results on the subsequent screen.


![Software interface for user input and data selection. \label{fig:pc1}](paper/figs/fig1.jpg)


If desired, both treeqsm.py and teeqsm_batch.py may be run directly from the command line using the following arguments:

    -intensity: filter point cloud based on values greater than the indicated intensity

    -normalize: recenter point cloud locations. Use this if your point cloud X, Y location values are very large (e.g., using UTM coordinates rather than a local coordinate system).

    -custominput: user sets specific patch diameters to test

    -ipd: initial patch diameter

    -minpd: min patch diameter

    -maxpd: maximum patch diameter

    -name: specifies a name for the current modeling run. This will be appended to the name generated by PyTLiDAR

    -outputdirectory: specifies the directory to put the "results" folder

    -numcores: specify number of cores to use to process files in parallel. Only valid in batched mode, Must be a single integer

    -optimum: specify an optimum metric to select best model to save 

    -help: displays the run options

    -verbose: verbose mode, displays outputs from PyTLiDAR as it processes

    -h: displays the run options

    -v: verbose mode

### TreeQSM Module Usage

# Tree Segmentation

# Graph-Based Leaf Separation

# Region Growing Leaf Separation

# Ecomodel
Ecomodel is an experimental module intended to provide detailed metrics for complex environments

### Create a .env file
make a file in your parent director named `.env` and paste the following into it replace the ... with the filepath to your data
```
DATA_FOLDER_FILEPATH = ...
```
